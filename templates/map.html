{% extends "base.html" %}
{% load static %}

{% block extra_head %}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+4sPS+rm7ZjMJc3ihfVL+u4kWVfGmSJJIXe3dGfQo=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j7lpvJyGep6oWQOuAf48G8U8m9DxnE7U1vAU0hU=" crossorigin=""></script>
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
  </style>
{% endblock %}

{% block content %}
  <h2>Malaria Risk Map - Cameroon</h2>
  <div id="map"></div>

  <script>
    const map = L.map('map').setView([6.6111, 20.9394], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 15,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map); 

    L.geoJSON(geojson, {
      style: function (feature) {
        const level = feature.properties.risk_level;
        const color = level === 'high' ? 'red' : level === 'medium' ? 'orange' : 'green';
        return { color: color, weight: 2, fillOpacity: 0.5 };
      },
      onEachFeature: function (feature, layer) {
        const popupContent = `<b>${feature.properties.name}</b><br>Risk: ${feature.properties.risk_level}`;
        layer.bindPopup(popupContent);
      }
    }).addTo(map);
  </script>

  <script>
  const geojson = JSON.parse('{{ geojson|escapejs }}');
</script>

{% endblock %}